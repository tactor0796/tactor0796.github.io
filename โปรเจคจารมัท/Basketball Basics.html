<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Basketball Basics ‚Äì ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { color-scheme: light dark; }
    html,body { height:100%; }
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; }

    /* ===== Utility-like custom classes (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ @apply ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) ===== */
    .ui-card{
      background: rgba(255,255,255,.7);
      box-shadow: 0 10px 30px rgba(2,6,23,.06);
      border-radius: 1rem;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(2,6,23,.06);
    }
    .dark .ui-card{
      background: rgba(9,9,11,.6);
      border-color: rgba(255,255,255,.08);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .ui-chip{
      display:inline-flex;align-items:center;gap:.375rem;
      padding:.25rem .5rem;border-radius:9999px;font-size:.75rem;font-weight:600;
      background:#f4f4f5;color:#18181b;border:1px solid rgba(0,0,0,.04);
    }
    .dark .ui-chip{ background:#18181b; color:#e5e7eb; border-color:rgba(255,255,255,.06); }

    .ui-btn{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.5rem .75rem;border-radius: .875rem;font-weight:700;font-size:.9rem;
      background:#0f172a;color:white; transition: transform .06s ease, opacity .2s ease;
    }
    .ui-btn:hover{ opacity:.95; transform: translateY(-1px); }
    .dark .ui-btn{ background:white; color:#0f172a; }

    .ui-btn-outline{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.5rem .75rem;border-radius:.875rem;font-weight:700;font-size:.9rem;
      border:1px solid rgba(24,24,27,.2); color:#18181b; background:transparent;
      transition: background .2s ease, border-color .2s ease, transform .06s ease;
    }
    .ui-btn-outline:hover{ background:rgba(24,24,27,.04); transform: translateY(-1px); }
    .dark .ui-btn-outline{ border-color: rgba(255,255,255,.2); color:#e5e7eb; }
    .dark .ui-btn-outline:hover{ background: rgba(255,255,255,.06); }

    .ui-tab{
      padding:.5rem .75rem;border-radius:.875rem;font-weight:700;font-size:.9rem;cursor:pointer;
      border:1px solid transparent; transition: background .2s ease, color .2s ease, border-color .2s ease;
    }
    .ui-tab:hover{ border-color: rgba(24,24,27,.2); }
    .dark .ui-tab:hover{ border-color: rgba(255,255,255,.2); }
    .ui-tab-active{
      background:#0f172a;color:white;
    }
    .dark .ui-tab-active{ background:white; color:#0f172a; }

    .progress { height: 10px; border-radius:9999px; }

    dialog::backdrop { background: rgb(0 0 0 / .6); }

    /* ===== Decorative background ===== */
    .bg-decor{
      position: fixed; inset:0; z-index:-1; pointer-events:none; overflow:hidden;
      background:
        radial-gradient(800px 400px at 10% -10%, rgba(59,130,246,.20), transparent 60%),
        radial-gradient(700px 500px at 110% 10%, rgba(16,185,129,.18), transparent 60%),
        radial-gradient(900px 600px at 50% 120%, rgba(217,70,239,.14), transparent 60%),
        linear-gradient(to bottom, #fafafa, #fafafa);
    }
    .dark .bg-decor{
      background:
        radial-gradient(800px 400px at 10% -10%, rgba(59,130,246,.16), transparent 60%),
        radial-gradient(700px 500px at 110% 10%, rgba(16,185,129,.14), transparent 60%),
        radial-gradient(900px 600px at 50% 120%, rgba(217,70,239,.12), transparent 60%),
        linear-gradient(to bottom, #09090b, #0a0a0a);
    }
    /* soft grid */
    .bg-grid{
      position:fixed; inset:0; z-index:-1; pointer-events:none;
      background-image:
        linear-gradient(to right, rgba(0,0,0,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,0,0,.05) 1px, transparent 1px);
      background-size: 24px 24px;
      mask-image: radial-gradient(1000px 600px at 50% 0%, rgba(0,0,0,.25), transparent 70%);
    }
    .dark .bg-grid{
      background-image:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
    }

    /* Nice scrollbar */
    *{ scrollbar-width: thin; scrollbar-color: rgba(100,116,139,.5) transparent; }
    *::-webkit-scrollbar{ height:10px;width:10px; }
    *::-webkit-scrollbar-thumb{ background: rgba(100,116,139,.45); border-radius: 9999px; }
    *::-webkit-scrollbar-track{ background: transparent; }
  </style>
</head>

<body class="bg-zinc-50 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 min-h-screen">
  <div class="bg-decor"></div>
  <div class="bg-grid"></div>

  <!-- ===== Header ===== -->
  <header class="max-w-6xl mx-auto px-4 pt-10 pb-6">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="h-11 w-11 rounded-2xl bg-gradient-to-br from-indigo-500 via-sky-500 to-emerald-500 flex items-center justify-center shadow-lg ring-1 ring-black/10">
          <span class="text-xl">üèÄ</span>
        </div>
        <div>
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">
            <span class="bg-clip-text text-transparent bg-gradient-to-r from-zinc-900 via-zinc-800 to-zinc-700 dark:from-white dark:via-zinc-200 dark:to-zinc-300">
              Basketball Basics
            </span>
          </h1>
          <p class="text-zinc-600 dark:text-zinc-400 text-sm md:text-base">‡πÅ‡∏≠‡∏õ‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏• ‚Äì ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Ä¢ ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å ‚Ä¢ ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‚Ä¢ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="btn-reset" class="ui-btn-outline">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button id="btn-theme" class="ui-btn" title="‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏á">üåì <span class="hidden md:inline">‡πÇ‡∏´‡∏°‡∏î</span></button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-24">
    <!-- Tabs -->
    <div class="flex flex-wrap gap-2 mb-5">
      <button data-tab="home" class="ui-tab ui-tab-active">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      <button data-tab="lessons" class="ui-tab">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
      <button data-tab="drills" class="ui-tab">‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å</button>
      <button data-tab="quiz" class="ui-tab">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
      <button data-tab="stats" class="ui-tab">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
      <button data-tab="profile" class="ui-tab">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
      <button data-tab="comments" class="ui-tab">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</button>
    </div>

    <!-- HOME -->
    <section id="tab-home" class="space-y-4 animate-[fadeIn_.25s_ease]">
      <div class="grid md:grid-cols-3 gap-4">
        <div class="ui-card p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h3>
            <span class="ui-chip" id="streakChip">üî• 0 ‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î</span>
          </div>
          <div class="mt-3">
            <p class="text-sm text-zinc-500 dark:text-zinc-400">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            <div class="w-full bg-zinc-200/70 dark:bg-zinc-800/70 rounded-full progress mt-1 overflow-hidden">
              <div id="progLessons" class="h-full rounded-full bg-gradient-to-r from-emerald-400 to-emerald-600 transition-all" style="width:0%"></div>
            </div>
            <p class="text-xs mt-1" id="progLessonsTxt">0%</p>
          </div>
          <div class="mt-3">
            <p class="text-sm text-zinc-500 dark:text-zinc-400">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
            <div class="w-full bg-zinc-200/70 dark:bg-zinc-800/70 rounded-full progress mt-1 overflow-hidden">
              <div id="progQuizzes" class="h-full rounded-full bg-gradient-to-r from-indigo-400 to-indigo-600 transition-all" style="width:0%"></div>
            </div>
            <p class="text-xs mt-1" id="progQuizzesTxt">0%</p>
          </div>
        </div>

        <div class="ui-card p-4 md:col-span-2">
          <div class="flex items-center gap-3">
            <span class="text-2xl">üìö</span>
            <div>
              <h3 class="font-semibold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</h3>
              <p class="text-sm text-zinc-500 dark:text-zinc-400">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
            </div>
          </div>
          <div id="quickStart" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 mt-3"></div>
        </div>
      </div>

      <div class="ui-card p-4">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
          <span class="text-sm text-zinc-500 dark:text-zinc-400" id="bmCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
        </div>
        <div id="bookmarkList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 mt-3"></div>
      </div>
    </section>

    <!-- LESSONS -->
    <section id="tab-lessons" class="hidden space-y-4 animate-[fadeIn_.25s_ease]">
      <div class="ui-card p-4">
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
          <div class="flex-1 relative">
            <input id="search" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ö‡∏≠‡∏•, ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤, ‡∏¢‡∏¥‡∏á"
              class="w-full px-4 py-2.5 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/80 dark:bg-zinc-900/70 focus:outline-none focus:ring-4 focus:ring-sky-300/40 dark:focus:ring-sky-400/30"/>
            <div class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400">‚åòK</div>
          </div>
          <button id="clearSearch" class="ui-btn-outline">‡∏•‡πâ‡∏≤‡∏á</button>
        </div>
      </div>
      <div id="lessonList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>

    <!-- DRILLS -->
    <section id="tab-drills" class="hidden space-y-4 animate-[fadeIn_.25s_ease]">
      <div id="drillList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>

    <!-- QUIZ -->
    <section id="tab-quiz" class="hidden space-y-4 animate-[fadeIn_.25s_ease]">
      <div class="ui-card p-4 space-y-3">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
          <span class="ui-chip" id="quizProgress">0 / 0</span>
        </div>
        <div id="quizArea" class="space-y-3"></div>
      </div>
    </section>

    <!-- STATS -->
    <section id="tab-stats" class="hidden space-y-4 animate-[fadeIn_.25s_ease]">
      <div class="ui-card p-4">
        <h3 class="font-semibold">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h3>
        <canvas id="statChart" width="600" height="260" class="mt-3 w-full"></canvas>
        <div class="text-sm text-zinc-500 dark:text-zinc-400 mt-2" id="statText"></div>
      </div>
      <div class="ui-card p-4">
        <h3 class="font-semibold">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <ul id="historyList" class="mt-2 space-y-2 text-sm"></ul>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="tab-profile" class="hidden space-y-4 animate-[fadeIn_.25s_ease]">
      <div class="ui-card p-4">
        <h3 class="font-semibold">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
        <p class="text-sm text-zinc-500 dark:text-zinc-400">‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ LocalStorage</p>
        <div class="mt-3 grid sm:grid-cols-2 gap-3">
          <div class="p-3 rounded-xl bg-zinc-100/80 dark:bg-zinc-800/70 border border-zinc-200 dark:border-zinc-700">
            <div class="text-sm">‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î (Streak)</div>
            <div class="text-2xl font-bold" id="streakCount">0</div>
          </div>
          <div class="p-3 rounded-xl bg-zinc-100/80 dark:bg-zinc-800/70 border border-zinc-200 dark:border-zinc-700">
            <div class="text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡πä‡∏Å‡∏°‡∏≤‡∏£‡πå‡∏Å</div>
            <div class="text-2xl font-bold" id="bmCountProfile">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- COMMENTS -->
    <section id="tab-comments" class="hidden space-y-4 animate-[fadeIn_.25s_ease]">
      <div class="ui-card p-4">
        <h3 class="font-semibold">üí¨ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</h3>
        <form id="commentForm" class="mt-3 space-y-3">
          <div class="grid sm:grid-cols-2 gap-3">
            <input type="text" id="usernameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"
              class="w-full px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/80 dark:bg-zinc-900/70 focus:outline-none focus:ring-4 focus:ring-sky-300/40 dark:focus:ring-sky-400/30">
            <input type="file" id="imageInput" accept="image/*" class="w-full text-sm text-sky-600 dark:text-sky-400">
          </div>
          <textarea id="commentInput" rows="3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."
            class="w-full px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white/80 dark:bg-zinc-900/70 focus:outline-none focus:ring-4 focus:ring-violet-300/40 dark:focus:ring-violet-400/30"></textarea>
          <div class="flex items-center justify-between">
            <div class="text-xs text-zinc-500 dark:text-zinc-400" id="charCount">0/300</div>
            <button type="submit" class="ui-btn-outline">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</button>
          </div>
          <div id="previewWrap" class="hidden">
            <div class="mt-2 text-xs text-zinc-500 dark:text-zinc-400">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</div>
            <img id="previewImg" class="mt-2 rounded-xl max-h-48 border border-zinc-200 dark:border-zinc-700" />
          </div>
        </form>
      </div>

      <div class="ui-card p-4">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">üìú ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
          <button id="btn-clear-comments" class="ui-btn-outline text-xs">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
        <ul id="commentList" class="mt-3 space-y-3 text-sm"></ul>
      </div>
    </section>
  </main>

  <footer class="text-center text-xs text-zinc-500 dark:text-zinc-400 py-10">
    ‡∏ó‡∏≥‡∏î‡πâ‡∏ß‡∏¢ ‚ù§ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  </footer>

  <!-- ===== App Script ===== -->
  <script>
    // ---------- Theme ----------
    const root = document.documentElement;
    const themeBtn = document.getElementById('btn-theme');
    const THEME_KEY = 'bb_theme';
    const setTheme = (mode) => {
      if (mode === 'dark') root.classList.add('dark'); else root.classList.remove('dark');
      localStorage.setItem(THEME_KEY, mode);
    };
    setTheme(localStorage.getItem(THEME_KEY) || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
    themeBtn.addEventListener('click', () => setTheme(root.classList.contains('dark') ? 'light' : 'dark'));

    // ===================== DATA ===================== //
    const CURRICULUM = [
      { id:"rules", title:"‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", level:"‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", duration:12, tags:["‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤","‡∏™‡∏ô‡∏≤‡∏°","‡∏ü‡∏≤‡∏ß‡∏•‡πå"], video:"https://www.youtube.com/embed/mZ5dT0a0sL8",
        content:`- ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏ô‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô 28x15 ‡πÄ‡∏°‡∏ï‡∏£\n- ‡πÄ‡∏™‡πâ‡∏ô 3 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô, ‡πÄ‡∏™‡πâ‡∏ô‡∏ü‡∏≤‡∏ß‡∏•‡πå, ‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏ô‡∏≤‡∏°\n- ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô 4 ‡∏Ñ‡∏ß‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå\n- ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ö‡∏≠‡∏•: ‡∏´‡πâ‡∏≤‡∏°‡∏ñ‡∏∑‡∏≠‡∏™‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡πà‡∏≠ (Double Dribble)\n- ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô: ‡∏´‡πâ‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á (Traveling)\n- ‡∏ü‡∏≤‡∏ß‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏ó‡∏µ‡∏°, ‡∏Å‡∏≤‡∏£‡∏ä‡∏π‡πâ‡∏ï‡∏•‡∏π‡∏Å‡πÇ‡∏ó‡∏© (Free Throws)`},
      { id:"dribbling", title:"‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ö‡∏≠‡∏• (Dribbling)", level:"‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", duration:15, tags:["‡∏ó‡∏±‡∏Å‡∏©‡∏∞","‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ö‡∏≠‡∏•"], video:"https://www.youtube.com/embed/I7WQqHcY7iU",
        content:`- ‡∏ó‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: Low, Mid, High Dribble\n- ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ù‡πà‡∏≤‡∏°‡∏∑‡∏≠\n- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á: Crossover, Behind-the-Back, Between-the-Legs\n- ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å: ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏•‡∏≤‡∏•‡∏≠‡∏°, ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏™‡πâ‡∏ô, ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏™‡∏•‡∏±‡∏ö‡∏°‡∏∑‡∏≠`},
      { id:"passing", title:"‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ö‡∏≠‡∏• (Passing)", level:"‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", duration:10, tags:["‡∏ó‡∏±‡∏Å‡∏©‡∏∞","‡∏™‡πà‡∏á‡∏ö‡∏≠‡∏•"], video:"https://www.youtube.com/embed/IVk1wYQv5yA",
        content:`- Chest Pass, Bounce Pass, Overhead Pass\n- ‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏ó‡πâ‡∏≤‡πÑ‡∏´‡∏•‡πà‡∏Å‡∏ß‡πâ‡∏≤‡∏á, ‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡∏≥‡∏ï‡∏±‡∏ß\n- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏™‡πà‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‡∏ï‡∏£‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢`},
      { id:"shooting", title:"‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á (Shooting)", level:"‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", duration:20, tags:["‡∏ó‡∏±‡∏Å‡∏©‡∏∞","‡∏¢‡∏¥‡∏á"], video:"https://www.youtube.com/embed/5u7D4vU8x2k",
        content:`- ‡∏´‡∏•‡∏±‡∏Å BEEF: Balance, Eyes, Elbow, Follow-through\n- Layup, Jump Shot, Free Throw, Three-point\n- ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å: ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ä‡∏π‡∏ï‡πÉ‡∏Å‡∏•‡πâ‡∏´‡πà‡∏ß‡∏á, ‡∏ß‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡πà‡∏≤‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏à‡∏∏‡∏î`},
      { id:"defense", title:"‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (Defense)", level:"‡∏Å‡∏•‡∏≤‡∏á", duration:18, tags:["‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô","‡πÅ‡∏°‡∏ô‡∏ó‡∏π‡πÅ‡∏°‡∏ô","‡πÇ‡∏ã‡∏ô"], video:"https://www.youtube.com/embed/1p7A0xk8b5A",
        content:`- ‡∏ó‡πà‡∏≤‡∏¢‡∏∑‡∏ô: Low Stance, ‡∏°‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô\n- Man-to-Man ‡πÅ‡∏•‡∏∞ Zone ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô\n- ‡∏´‡∏•‡∏±‡∏Å: ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£, ‡πÅ‡∏ó‡πá‡∏Å, ‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏ü`},
      { id:"strategy", title:"‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô", level:"‡∏Å‡∏•‡∏≤‡∏á", duration:14, tags:["‡πÅ‡∏ó‡∏Ñ‡∏ï‡∏¥‡∏Å","‡∏ó‡∏µ‡∏°"], video:"https://www.youtube.com/embed/3C1gR0GtJFc",
        content:`- Fast Break: ‡∏ß‡∏¥‡πà‡∏á‡∏™‡∏ß‡∏ô‡∏Å‡∏•‡∏±‡∏ö\n- Pick & Roll: ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏¥‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πà‡∏ß‡∏á\n- Give & Go: ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö`}
    ];

    const QUIZZES = [
      { id:"q1", lessonId:"rules", question:"‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ö‡∏≠‡∏•‡πÅ‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏™‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£?", choices:["Traveling","Double Dribble","Carrying","Backcourt"], answer:1, explain:"Double Dribble ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏™‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡πà‡∏≠‡∏ô" },
      { id:"q2", lessonId:"shooting", question:"‡∏´‡∏•‡∏±‡∏Å BEEF ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ E ‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏≠‡∏∞‡πÑ‡∏£?", choices:["Energy","Elbow","Eyes","Elevate"], answer:1, explain:"BEEF = Balance, Eyes, Elbow, Follow-through" },
      { id:"q3", lessonId:"passing", question:"‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ö‡∏≠‡∏•‡∏ä‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£?", choices:["Chest Pass","Bounce Pass","Overhead Pass","Lob"], answer:1, explain:"Bounce Pass ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏•‡∏ä‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô" },
      { id:"q4", lessonId:"defense", question:"‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏ö‡∏Ñ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤?", choices:["Zone","Box-and-One","Man-to-Man","Triangle"], answer:2, explain:"Man-to-Man ‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏ö‡∏ï‡∏±‡∏ß‡∏ï‡πà‡∏≠‡∏ï‡∏±‡∏ß" },
    ];

    const DRILLS = [
      { id:"d1", title:"Form Shooting 50 ‡∏•‡∏π‡∏Å", mins:10, focus:["Shooting"], steps:["‡∏¢‡∏∑‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏´‡πà‡∏ß‡∏á ‡∏ä‡∏π‡∏ï‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° 5 ‡∏à‡∏∏‡∏î ‡∏à‡∏∏‡∏î‡∏•‡∏∞ 10 ‡∏•‡∏π‡∏Å","‡πÇ‡∏ü‡∏Å‡∏±‡∏™ Follow-through ‡πÅ‡∏•‡∏∞‡∏ö‡∏≤‡∏•‡∏≤‡∏ô‡∏ã‡πå"] },
      { id:"d2", title:"Stationary Dribble 5 ‡∏ô‡∏≤‡∏ó‡∏µ", mins:5, focus:["Dribbling"], steps:["Low/Mid/High ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 40 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á","Crossover / Between / Behind ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 20 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á"] },
      { id:"d3", title:"Passing ‡∏ú‡∏ô‡∏±‡∏á 100 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á", mins:8, focus:["Passing"], steps:["Chest/Bounce/Overhead ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ ~30 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á","‡∏à‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏•‡∏≤‡∏î"] },
    ];

    // ===================== STATE (LocalStorage) ===================== //
    const LS = {
      progress: "bb_progress_v1",
      bookmarks: "bb_bookmarks_v1",
      history:  "bb_history_v1",
      streak:   "bb_streak_v1",
      comments: "bb_comments_v1",
    };

    const readLS  = (k,f)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? f; }catch{ return f; } };
    const writeLS = (k,v)=>{ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} };

    let state = {
      progress:  readLS(LS.progress, { lessons:{}, quizzes:{} }),
      bookmarks: readLS(LS.bookmarks, []),
      history:   readLS(LS.history, []),
      streak:    readLS(LS.streak, { day: todayStr(), count: 0 }),
      comments:  readLS(LS.comments, []),
      tab: "home",
      query: "",
      currentLesson: null,
      quizIndex: 0,
    };

    function todayStr(){ return new Date().toISOString().slice(0,10); }
    function isYesterday(day){
      const d=new Date(day), t=new Date(), y=new Date(t); y.setDate(t.getDate()-1);
      return d.toDateString()===y.toDateString();
    }
    function pushHistory(type,id){
      state.history.push({type,id,ts:Date.now()}); writeLS(LS.history,state.history);
      const now = todayStr();
      if(state.streak.day!==now){
        const consecutive = isYesterday(state.streak.day);
        state.streak = { day: now, count: consecutive ? (state.streak.count+1) : 1 };
        writeLS(LS.streak, state.streak);
      }
    }

    // ===================== HELPERS ===================== //
    const $  = (sel,root=document)=>root.querySelector(sel);
    const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
    const pct = (n,d)=> d? Math.round((n/d)*100) : 0;

    // ===================== RENDER: HOME ===================== //
    function renderHome(){
      const qs = $("#quickStart");
      qs.innerHTML = CURRICULUM.map(c => cardLessonSmall(c)).join("");
      renderBookmarks();

      const completed = Object.values(state.progress.lessons).filter(x=>x.completed).length;
      const lessonPct = pct(completed, CURRICULUM.length);
      $("#progLessons").style.width = lessonPct+"%";
      $("#progLessonsTxt").textContent = lessonPct+"%";

      const quizDone = Object.values(state.progress.quizzes).filter(Boolean).length;
      const quizPctVal = pct(quizDone, QUIZZES.length);
      $("#progQuizzes").style.width = quizPctVal+"%";
      $("#progQuizzesTxt").textContent = quizPctVal+"%";

      $("#streakChip").textContent = `üî• ${state.streak.count} ‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î`;
      $("#streakCount").textContent = state.streak.count;
    }

    function renderBookmarks(){
      const list = $("#bookmarkList");
      const items = state.bookmarks.map(id=>CURRICULUM.find(c=>c.id===id)).filter(Boolean);
      $("#bmCount").textContent = `${items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      $("#bmCountProfile").textContent = items.length;
      list.innerHTML = items.length ? items.map(c=>cardLessonSmall(c)).join("") :
        `<div class="text-sm text-zinc-500 dark:text-zinc-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</div>`;
    }

    // ===================== RENDER: LESSONS ===================== //
    function renderLessons(){
      const term = state.query.trim().toLowerCase();
      const list = $("#lessonList");
      const items = !term ? CURRICULUM :
        CURRICULUM.filter(c=>[c.title,c.content,c.tags.join(" ")].join(" ").toLowerCase().includes(term));
      list.innerHTML = items.map(c=>cardLesson(c)).join("");
      $$("[data-open]").forEach(btn=>btn.addEventListener("click",()=>openLesson(btn.dataset.open)));
      $$("[data-bm]").forEach(btn=>btn.addEventListener("click",()=>toggleBookmark(btn.dataset.bm)));
    }

    // ===================== RENDER: DRILLS ===================== //
    function renderDrills(){
      const wrap = $("#drillList");
      wrap.innerHTML = DRILLS.map(d=>`
        <div class="ui-card p-4 flex flex-col">
          <div class="flex items-center justify-between">
            <h4 class="font-semibold">${d.title}</h4>
            <span class="ui-chip">‚è±Ô∏è ${d.mins} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
          </div>
          <div class="mt-2 text-sm text-zinc-500 dark:text-zinc-400">‡πÇ‡∏ü‡∏Å‡∏±‡∏™: ${d.focus.join(", ")}</div>
          <ol class="mt-2 text-sm list-decimal pl-5 space-y-1">
            ${d.steps.map(s=>`<li>${s}</li>`).join("")}
          </ol>
          <button class="ui-btn mt-3 self-end" onclick="markDrill('${d.id}')">‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
        </div>
      `).join("");
    }

    // ===================== RENDER: QUIZ ===================== //
    function renderQuiz(){
      const area = $("#quizArea");
      const total = QUIZZES.length;
      const i = state.quizIndex;
      $("#quizProgress").textContent = `${i+1} / ${total}`;
      const q = QUIZZES[i];
      const done = !!state.progress.quizzes[q.id];
      area.innerHTML = `
        <div class="text-sm text-zinc-500 dark:text-zinc-400">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ${CURRICULUM.find(c=>c.id===q.lessonId)?.title || "-"}</div>
        <div class="text-lg font-semibold">${q.question}</div>
        <div class="grid gap-2 mt-2">
          ${q.choices.map((c,idx)=>`
            <button class="ui-btn-outline text-left" data-choice="${idx}">${String.fromCharCode(65+idx)}. ${c}</button>
          `).join("")}
        </div>
        <div id="quizMsg" class="mt-2 text-sm"></div>
        <div class="flex items-center justify-between mt-3">
          <button class="ui-btn-outline" id="prevQ" ${i===0?"disabled": ""}>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <button class="ui-btn" id="nextQ">${i===total-1?"‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•":"‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ"}</button>
        </div>
      `;
      $$("[data-choice]").forEach(btn=>btn.addEventListener("click",()=>selectChoice(parseInt(btn.dataset.choice))));
      $("#prevQ").addEventListener("click",()=>{ if(state.quizIndex>0){ state.quizIndex--; renderQuiz(); } });
      $("#nextQ").addEventListener("click",()=>{
        if(state.quizIndex===total-1){
          alert(`‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${scoreCount()} / ${total}`);
        } else { state.quizIndex++; renderQuiz(); }
      });
      if(done){ $("#quizMsg").textContent = "‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß"; }
    }
    const scoreCount = ()=> Object.values(state.progress.quizzes).filter(Boolean).length;

    // ===================== CARDS / UI ===================== //
    function cardLessonSmall(c){
      const completed = !!(state.progress.lessons[c.id]?.completed);
      const bookmarked = state.bookmarks.includes(c.id);
      return `
        <div class="ui-card p-4 transition hover:-translate-y-0.5">
          <div class="flex items-center justify-between">
            <h4 class="font-semibold truncate pr-2">${c.title}</h4>
            <span class="ui-chip">‚è±Ô∏è ${c.duration} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
          </div>
          <div class="mt-2 flex flex-wrap gap-2">
            ${c.tags.map(t=>`<span class="ui-chip">${t}</span>`).join("")}
          </div>
          <div class="mt-3 flex items-center justify-between">
            <button class="ui-btn" onclick="openLesson('${c.id}')">‡πÄ‡∏õ‡∏¥‡∏î</button>
            <button class="ui-btn-outline" onclick="toggleBookmark('${c.id}')">${bookmarked?"‚òÖ ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡∏î":"‚òÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡∏î"}</button>
          </div>
          ${completed?`<div class="mt-2 text-emerald-600 dark:text-emerald-400 text-sm">‚úî ‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß</div>`:""}
        </div>`;
    }

    function cardLesson(c){
      const completed = !!(state.progress.lessons[c.id]?.completed);
      const bookmarked = state.bookmarks.includes(c.id);
      return `
        <div class="ui-card p-4 flex flex-col transition hover:-translate-y-0.5">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h4 class="font-semibold">${c.title}</h4>
              <div class="text-xs text-zinc-500 dark:text-zinc-400 mt-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${c.level} ‚Ä¢ ‚è±Ô∏è ${c.duration} ‡∏ô‡∏≤‡∏ó‡∏µ</div>
            </div>
            <div class="flex gap-2">
              <button class="ui-btn-outline" data-bm="${c.id}">${bookmarked?"‚òÖ ‡πÇ‡∏õ‡∏£‡∏î":"‚òÜ ‡πÇ‡∏õ‡∏£‡∏î"}</button>
              <button class="ui-btn" data-open="${c.id}">‡πÄ‡∏õ‡∏¥‡∏î</button>
            </div>
          </div>
          <div class="mt-2 flex flex-wrap gap-2">${c.tags.map(t=>`<span class="ui-chip">${t}</span>`).join("")}</div>
          ${completed?`<div class="mt-2 text-emerald-600 dark:text-emerald-400 text-sm">‚úî ‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß</div>`:""}
        </div>`;
    }

    // ===================== LESSON MODAL ===================== //
    const modalHtml = `
      <dialog id="lessonModal" class="max-w-3xl w-[92vw] rounded-2xl p-0 backdrop:backdrop-blur">
        <form method="dialog" class="p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between bg-white/80 dark:bg-zinc-950/70 rounded-t-2xl">
          <h3 id="lessonTitle" class="font-semibold">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</h3>
          <button class="ui-btn-outline" id="closeModal">‡∏õ‡∏¥‡∏î</button>
        </form>
        <div class="p-4 space-y-3 bg-white/70 dark:bg-zinc-950/60 rounded-b-2xl">
          <div class="aspect-video w-full overflow-hidden rounded-xl bg-black/10">
            <iframe id="lessonVideo" class="w-full h-full" src="" title="YouTube video" allowfullscreen></iframe>
          </div>
          <div id="lessonContent" class="prose prose-zinc dark:prose-invert max-w-none"></div>
          <div class="flex items-center justify-between pt-2">
            <button id="btnBookmark" class="ui-btn-outline">‚òÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</button>
            <div class="flex items-center gap-2">
              <button id="btnComplete" class="ui-btn">‚úîÔ∏è ‡∏ó‡∏≥‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß</button>
            </div>
          </div>
        </div>
      </dialog>`;
    document.body.insertAdjacentHTML('beforeend', modalHtml);

    function openLesson(id){
      const c = CURRICULUM.find(x=>x.id===id); if(!c) return;
      state.currentLesson = id;
      $("#lessonTitle").textContent = c.title;
      $("#lessonVideo").src = c.video;
      $("#lessonContent").innerHTML = `<pre class="whitespace-pre-wrap text-sm leading-relaxed">${c.content}</pre>`;
      $("#btnBookmark").textContent = state.bookmarks.includes(id) ? "‚òÖ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß" : "‚òÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î";
      $("#lessonModal").showModal();
      $("#closeModal").addEventListener("click", ()=>$("#lessonModal").close(), { once:true });
      pushHistory("lesson", id);
    }
    $("#btnComplete")?.addEventListener("click", ()=>{
      if(!state.currentLesson) return;
      completeLesson(state.currentLesson);
      renderHome(); renderLessons();
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
    });
    $("#btnBookmark")?.addEventListener("click", ()=>{
      if(!state.currentLesson) return;
      toggleBookmark(state.currentLesson); openLesson(state.currentLesson);
      renderHome(); renderLessons();
    });

    // ===================== INTERACTIONS ===================== //
    function toggleBookmark(id){
      const i = state.bookmarks.indexOf(id);
      if(i>=0) state.bookmarks.splice(i,1); else state.bookmarks.push(id);
      writeLS(LS.bookmarks, state.bookmarks);
      renderBookmarks(); renderLessons();
    }
    function completeLesson(id, minutes=5){
      state.progress.lessons[id] = { completed: true, minutes };
      writeLS(LS.progress, state.progress);
      pushHistory("complete", id);
    }
    function markDrill(id){
      pushHistory("drill", id);
      alert("‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß üéâ");
    }
    function selectChoice(choice){
      const q = QUIZZES[state.quizIndex];
      const msg = $("#quizMsg");
      if(state.progress.quizzes[q.id]){ msg.textContent = "‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏ï‡∏≠‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß"; return; }
      const correct = choice === q.answer;
      state.progress.quizzes[q.id] = correct;
      writeLS(LS.progress, state.progress);
      pushHistory("quiz", q.id);
      msg.textContent = (correct?"‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‚úÖ ":"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‚ùå ")+ q.explain;
      renderHome(); renderStats();
    }

    // ===================== STATS ===================== //
    function renderStats(){
      const completed = Object.values(state.progress.lessons).filter(x=>x.completed).length;
      const quizScore = scoreCount();
      const lessonPct = pct(completed, CURRICULUM.length);
      const quizPctVal = pct(quizScore, QUIZZES.length);
      $("#statText").textContent = `‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${completed}/${CURRICULUM.length} (${lessonPct}%) ‚Ä¢ ‡∏Ñ‡∏ß‡∏¥‡∏ã‡∏ñ‡∏π‡∏Å ${quizScore}/${QUIZZES.length} (${quizPctVal}%)`;

      const cvs = $("#statChart");
      const ctx = cvs.getContext("2d");
      ctx.clearRect(0,0,cvs.width,cvs.height);
      const W = cvs.width, H = cvs.height, pad=40, barW=120, gap=60;
      const data = [ {name: "‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", val: lessonPct}, {name: "‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö", val: quizPctVal} ];
      ctx.font = "14px Inter, sans-serif";
      ctx.fillStyle = getComputedStyle(document.documentElement).color;
      ctx.globalAlpha=0.15; ctx.fillRect(pad, H-pad, W-2*pad, 2); ctx.globalAlpha=1;
      data.forEach((d,i)=>{
        const x = pad + i*(barW+gap) + 20;
        const h = (H-2*pad) * d.val/100;
        const y = H-pad-h;
        const grd = ctx.createLinearGradient(0, y, 0, y+h);
        grd.addColorStop(0, i? "#4f46e5":"#10b981");
        grd.addColorStop(1, i? "#818cf8":"#34d399");
        ctx.fillStyle = grd;
        ctx.shadowColor = "rgba(0,0,0,.15)"; ctx.shadowBlur = 12; ctx.shadowOffsetY = 6;
        ctx.fillRect(x, y, barW, h);
        ctx.shadowColor = "transparent";
        ctx.fillStyle = getComputedStyle(document.documentElement).color;
        ctx.fillText(d.name, x, H-pad+18);
        ctx.fillText(d.val+"%", x+barW-40, y-8);
      });
    }

    function renderHistory(){
      const UL = $("#historyList");
      const items = state.history.slice(-10).reverse();
      UL.innerHTML = items.map(it=>{
        const title = it.type==="lesson"? (CURRICULUM.find(c=>c.id===it.id)?.title||it.id)
                    : it.type==="drill"? (DRILLS.find(d=>d.id===it.id)?.title||it.id)
                    : it.type==="quiz"? (QUIZZES.find(q=>q.id===it.id)?.question||it.id)
                    : it.id;
        const when = new Date(it.ts).toLocaleString();
        return `<li class="flex items-center justify-between p-2 rounded-xl bg-zinc-100/80 dark:bg-zinc-800/70 border border-zinc-200 dark:border-zinc-700">
                  <span>${title}</span>
                  <span class="text-zinc-500 text-xs">${when}</span>
                </li>`;
      }).join("");
    }

    // ===================== COMMENTS ===================== //
    const commentForm = document.getElementById("commentForm");
    const usernameInput = document.getElementById("usernameInput");
    const commentInput  = document.getElementById("commentInput");
    const imageInput    = document.getElementById("imageInput");
    const commentList   = document.getElementById("commentList");
    const previewWrap   = document.getElementById("previewWrap");
    const previewImg    = document.getElementById("previewImg");
    const charCount     = document.getElementById("charCount");
    const btnClearCmt   = document.getElementById("btn-clear-comments");

    const MAX_CHAR = 300;
    const toBase64 = (file)=> new Promise((resolve,reject)=>{
      const reader = new FileReader(); reader.readAsDataURL(file);
      reader.onload = ()=> resolve(reader.result); reader.onerror = e=> reject(e);
    });

    function renderComments(){
      commentList.innerHTML = state.comments.map(c => `
        <li class="p-3 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white/70 dark:bg-zinc-900/60">
          <div class="flex justify-between items-start">
            <div class="flex items-center gap-3">
              <div class="h-9 w-9 rounded-full bg-gradient-to-br from-indigo-500 to-sky-500 text-white flex items-center justify-center font-bold">
                ${c.username.slice(0,1).toUpperCase()}
              </div>
              <div>
                <strong class="text-zinc-900 dark:text-zinc-100">${c.username}</strong>
                <small class="block text-zinc-500 dark:text-zinc-400">${c.time}</small>
              </div>
            </div>
            <div class="flex gap-2">
              <button onclick="editComment(${c.id})" class="ui-btn-outline">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button onclick="deleteComment(${c.id})" class="ui-btn-outline">‡∏•‡∏ö</button>
            </div>
          </div>
          <p class="mt-2 leading-relaxed">${c.text}</p>
          ${c.image ? `<img src="${c.image}" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" class="mt-2 rounded-xl max-h-60 border border-zinc-200 dark:border-zinc-700">` : ""}
        </li>
      `).join("");
    }
    function saveAndRenderComments(){
      writeLS(LS.comments, state.comments); renderComments();
    }
    function deleteComment(id){
      if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      state.comments = state.comments.filter(c => c.id !== id);
      saveAndRenderComments();
    }
    function editComment(id){
      const comment = state.comments.find(c => c.id === id);
      if(!comment) return;
      const newText = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô:", comment.text);
      if(newText !== null){
        comment.text = newText.trim().slice(0, MAX_CHAR);
        saveAndRenderComments();
      }
    }

    commentForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = (usernameInput.value.trim() || "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏").slice(0, 24);
      const text = commentInput.value.trim().slice(0, MAX_CHAR);
      if (text === "" && !imageInput.files.length) return;

      let imageData = null;
      if (imageInput.files.length > 0) imageData = await toBase64(imageInput.files[0]);

      const newComment = { id: Date.now(), username, text, image: imageData, time: new Date().toLocaleString() };
      state.comments.unshift(newComment);
      saveAndRenderComments();

      commentInput.value = ""; imageInput.value = ""; previewWrap.classList.add("hidden");
      charCount.textContent = `0/${MAX_CHAR}`;
    });

    imageInput.addEventListener("change", async ()=>{
      if(imageInput.files.length){
        const src = await toBase64(imageInput.files[0]);
        previewImg.src = src; previewWrap.classList.remove("hidden");
      } else {
        previewWrap.classList.add("hidden");
      }
    });
    commentInput.addEventListener("input", ()=>{
      const len = commentInput.value.length;
      charCount.textContent = `${len}/${MAX_CHAR}`;
    });
    btnClearCmt.addEventListener("click", ()=>{
      if(confirm("‡∏•‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){
        state.comments = []; saveAndRenderComments();
      }
    });

    // ===================== NAV / INIT ===================== //
    function switchTab(name){
      state.tab = name;
      $$('[data-tab]').forEach(b=>{
        b.classList.toggle('ui-tab-active', b.dataset.tab===name);
        b.classList.toggle('ui-tab', true);
      });
      ['home','lessons','drills','quiz','stats','profile','comments']
        .forEach(id=>$('#tab-'+id).classList.add('hidden'));
      $('#tab-'+name).classList.remove('hidden');
      if(name==='stats'){ renderStats(); renderHistory(); }
      if(name==='quiz'){ renderQuiz(); }
      if(name==='drills'){ renderDrills(); }
    }
    $$('[data-tab]').forEach(b=>b.addEventListener('click', ()=>switchTab(b.dataset.tab)));

    $('#search').addEventListener('input', (e)=>{ state.query=e.target.value; renderLessons(); });
    $('#clearSearch').addEventListener('click', ()=>{ state.query=''; $('#search').value=''; renderLessons(); });

    $('#btn-reset').addEventListener('click', ()=>{
      if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á?')){
        Object.values(LS).forEach(k=>localStorage.removeItem(k));
        state.progress={lessons:{},quizzes:{}}; state.bookmarks=[]; state.history=[]; state.streak={day:todayStr(),count:0}; state.comments=[];
        renderHome(); renderLessons(); renderBookmarks(); renderStats(); renderHistory(); renderComments();
        alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      }
    });

    function renderStats(){ /* already defined above; keep hoisted */ }

    function renderHistory(){
      const UL = $("#historyList");
      const items = state.history.slice(-10).reverse();
      UL.innerHTML = items.map(it=>{
        const title = it.type==="lesson"? (CURRICULUM.find(c=>c.id===it.id)?.title||it.id)
                    : it.type==="drill"? (DRILLS.find(d=>d.id===it.id)?.title||it.id)
                    : it.type==="quiz"? (QUIZZES.find(q=>q.id===it.id)?.question||it.id)
                    : it.id;
        const when = new Date(it.ts).toLocaleString();
        return `<li class="flex items-center justify-between p-2 rounded-xl bg-zinc-100/80 dark:bg-zinc-800/70 border border-zinc-200 dark:border-zinc-700"><span>${title}</span><span class="text-zinc-500 text-xs">${when}</span></li>`;
      }).join("");
    }

    // First render
    renderHome();
    renderLessons();
    renderDrills();
    renderStats();
    renderHistory();
    renderComments();

    // ----- Keyboard shortcut: focus search (‚åòK / Ctrl K) -----
    window.addEventListener('keydown', (e)=>{
      if((e.metaKey || e.ctrlKey) && e.key.toLowerCase()==='k'){
        e.preventDefault();
        switchTab('lessons');
        $('#search').focus();
      }
    });

  </script>

  <!-- Small fadeIn animation -->
  <style>
    @keyframes fadeIn { from{ opacity:0; transform: translateY(4px);} to{ opacity:1; transform:none;} }
  </style>
</body>
</html>
